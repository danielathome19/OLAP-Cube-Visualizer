<html>
	<head>
        <meta charset="utf-8"/>
        <title>Data Cube Visualizer</title>
    </head>
    <style>
        #progress-wrp {
            border: 1px solid #0099CC;
            padding: 1px;
            position: relative;
            height: 30px;
            border-radius: 3px;
            margin: 10px;
            text-align: left;
            background: #fff;
            box-shadow: inset 1px 3px 6px rgba(0, 0, 0, 0.12);
        }

        #progress-wrp .progress-bar {
            height: 100%;
            border-radius: 3px;
            background-color: #13c279;
            width: 0;
            box-shadow: inset 1px 1px 10px rgba(0, 0, 0, 0.11);
        }

        #progress-wrp .status {
            top: 3px;
            left: 50%;
            position: absolute;
            display: inline-block;
            color: #000000;
        }
    </style>
	<body>
        <label for="data">Upload CSV file -- Note: the first row of the table must be the column headers!</label>
        <input type="file" id="fileupload" name="fileupload" onchange="submitcsv(this)">
        <div id="progress-wrp">
            <div class="progress-bar"></div>
            <div class="status">0%</div>
        </div>

        <br/><br/>
        <table id='navbar' style="border: 1px solid black; width: 100%; background-color: #6e6e6e;" >
            <th>
                <td>
                    <button id="btn0" onclick="button0();" disabled>Display Fact Table</button>
                </td>
                <td>
                    <button id="btn1" onclick="button1();" disabled>Display Aggregated Table</button>
                </td>
                <td>
                    <button id="btn2" onclick="button2();" disabled>Reinitialize Aggregate</button>
                </td>
                <td>    
                    <button id="btn3" onclick="button3();" disabled>Drill-down</button>
                </td>
                <td>    
                    <button id="btn4" onclick="button4();" disabled>Filter</button>
                </td>
                <td>    
                    <button id="btn5" onclick="button5();" disabled>View Plot</button>
                </td>
                <td>    
                    <button id="btn7" onclick="button7();" disabled>Reset Drill Aggregates</button>
                </td>
                <td>    
                    <button id="btn8" onclick="button8();" disabled>Reset Filters</button>
                </td>
                <td>    
                    <button id="btn9" onclick="button9();" disabled>Remove Drill Aggregate</button>
                </td>
                <td>    
                    <button id="btn10" onclick="button10();" disabled>Remove Filter</button>
                </td>
            </th>
        </table>

        <br/><br/>
        <table id='maintable' style="border: 1px solid black; float: left;" >
            <th>
                <td>test</td>
            </th>
            <tr>
                <td>tyest</td>
            </tr>
            <!-- <th> <td>... <td>... -->
            <!-- <tr> <td>... <td>... -->
            <!-- <tr> <td>... <td>... -->
        </table>
        
        <img id="plotimg" style="border: 1px solid black; float: right;" width=500 height=500 />

        <br/><br/>
        
        <!--
        <div>
            <p id="myLog" style="background-color:#000000; color: white;"></p>
        </div>
        -->
    </body>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        /*
        window.console = {
            log: function(str){
                var node = document.createElement("div");
                node.appendChild(document.createTextNode(str));
                document.getElementById("myLog").appendChild(node);
            }
        }
        */

        async function SavePhoto(inp) {
            //let user = { name:'john', age:34 };
            let formData = new FormData();
            let photo = inp.files[0];      
                
            formData.append("photo", photo);
            //formData.append("user", JSON.stringify(user));  
            
            try {
            let r = await fetch('/upload/image', {method: "POST", body: formData}); 
            console.log('HTTP response code:',r.status); 
            } catch(e) {
            console.log('Huston we have problem...:', e);
            }
            
        }

        async function submitcsv(inp) {
            btn0 = document.getElementById("btn0");
            btn0.disabled = true; 
            var upload = new Upload(inp.files[0]); 
            //alert(upload.getSize());
            //alert(upload.getType())
            upload.doUpload();
            btn0.disabled = false;
        }
 
        function button0() { // Display Fact Table
            /*
            var ul = document.getElementById("list");
            var li = document.createElement("li");
            li.appendChild(document.createTextNode("Four"));
            ul.appendChild(li);
            */
            text = "menu0";
            $.ajax({
                url: "http://localhost:5000/",
                type: "get",
                data: {message: text},
                success: function(response) {
                    console.log(response);
                },
                error: function(xhr) {
                    console.log(xhr);
                    //Do Something to handle error
                }
            });
        }

        function button1() { // Display Aggregated Table
            
        }
        
        function button2() { // Reinitialize Aggregate
            
        }
        
        function button3() { // Drill-down
            
        }
        
        function button4() { // Filter
            
        }
        
        function button5() { // View
            
        }
        
        function button7() { // Reset Drill Aggregates
            
        }
        
        function button8() { // Reset Filters
            
        }
        
        function button9() { // Remove Drill Aggreate
            
        }
        
        function button10() { // Remove Filter
            var inp = prompt("yay");
        }

        function sendmessage(text) {

        }
    </script>
    <script>
        var Upload = function (file) {
            this.file = file;
        };

        Upload.prototype.getType = function() {
            return this.file.type;
        };
        Upload.prototype.getSize = function() {
            return this.file.size;
        };
        Upload.prototype.getName = function() {
            return this.file.name;
        };
        Upload.prototype.doUpload = function () {
            var that = this;
            var formData = new FormData();

            // add assoc key values, this will be posts values
            formData.append("fileupload", this.file, this.getName());
            formData.append("upload_file", true);

            $.ajax({
                type: "POST",
                url: "http://localhost:5000/",
                xhr: function () {
                    var myXhr = $.ajaxSettings.xhr();
                    if (myXhr.upload) {
                        myXhr.upload.addEventListener('progress', that.progressHandling, false);
                    }
                    return myXhr;
                },
                success: function (data) {
                    // your callback here
                },
                error: function (error) {
                    // handle error
                },
                async: true,
                data: formData,
                cache: false,
                contentType: false,
                processData: false,
                timeout: 60000
            });
        };

        Upload.prototype.progressHandling = function (event) {
            var percent = 0;
            var position = event.loaded || event.position;
            var total = event.total;
            var progress_bar_id = "#progress-wrp";
            if (event.lengthComputable) {
                percent = Math.ceil(position / total * 100);
            }
            // update progressbars classes so it fits your code
            $(progress_bar_id + " .progress-bar").css("width", +percent + "%");
            $(progress_bar_id + " .status").text(percent + "%");
        };
    </script>
</html>

